<?xml version="1.0" encoding="UTF-8"?>
<rss xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
  <channel>
    <title>AlgorithmDog</title>
    <link>http://www.iwgc.cn/list/5566</link>
    <description>AlgorithmDog 讲述机器学习和系统研发的轶事,希望把这些事讲得生动有趣.每周日更新哦.欢迎关注.</description>
    <item>
      <title>在Spark 中实现单例模式的技巧</title>
      <link>http://www.iwgc.cn/link/3097906</link>
      <description>&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; 单例模式是一种常用的设计模式，但是在集群模式下的 Spark 中使用单例模式会引发一些错误。我们用下面代码作例子，解读在 Spark 中使用单例模式遇到的问题。&lt;span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img src="https://images.weserv.nl/?url=mmbiz.qpic.cn/mmbiz_png/Q3H1TCddfvPTzpWjtEFf3761157l7hWBWHnKicy6V4Dc8OjkCClSruFYyEicW41tDMWxuibWQODaloPqz4eufo0ZQ/0?wx_fmt=png"/&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;我们预期结果是数字和腾讯游戏座右铭，然后实际的结果确实数字和默认名字，如下所示&lt;/p&gt;&lt;p&gt;&lt;a rel="attachment wp-att-3435" style="border: 0px; vertical-align: baseline; color: rgb(116, 51, 153); background: transparent;"&gt;&lt;img src="https://images.weserv.nl/?url=mmbiz.qpic.cn/mmbiz_png/Q3H1TCddfvPTzpWjtEFf3761157l7hWBrrAZpqXSlOCBNYvOwMOrGOKGnOf8HsApcROEaCKD5Jh2QOmibvia7ASQ/0?wx_fmt=png"/&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;就像 Example.init("To create happiness with money") 没有执行一样。在 Stackoverflow 上，有不少人也碰到这个错误，比如&amp;nbsp;&lt;a style="border: 0px; vertical-align: baseline; color: rgb(116, 51, 153); background: transparent;"&gt;问题1&lt;/a&gt;、&lt;a style="border: 0px; vertical-align: baseline; color: rgb(116, 51, 153); background: transparent;"&gt;问题2&lt;/a&gt;和&lt;a style="border: 0px; vertical-align: baseline; color: rgb(116, 51, 153); background: transparent;"&gt;问题3&lt;/a&gt;。&lt;/p&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这是由什么原因导致的呢？Spark 执行算子之前，会将算子需要东西准备好并打包（这就是闭包的概念），分发到不同的 executor，但这里不包括类。类存在 jar 包中，随着 jar 包分发到不同的 executors 中。当不同的 executors 执行算子需要类时，直接从分发的 jar 包取得。这时候在 driver 上对类的静态变量进行改变，并不能影响 executors 中的类。拿上面的程序做例子，jar 包存的 Example.instance = new Example("default_name")，分发到不同的 executors。这时候不同 executors 中 Example.getInstance().name 等于 "default_name"。&lt;/p&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这个部分涉及到 Spark 底层原理，很难堂堂正正地解决，只能采取取巧的办法。不能再 executors 使用类，那么我们可以用对象嘛。我们可以把 Example 的实例对象塞进算子的闭包，随着闭包分发到不同的 executors。修改之后的代码如下所示。&lt;/p&gt;&lt;p&gt;&lt;img src="https://images.weserv.nl/?url=mmbiz.qpic.cn/mmbiz_png/Q3H1TCddfvPTzpWjtEFf3761157l7hWBW6bkVo7ibYeouMicNFzJxTOickQ6N7vBlOlqSDxsGNZFicuOrnVZ9KWTpw/0?wx_fmt=png"/&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;上面代码在集群模式下的 Spark 运行结果是数字和腾讯游戏座右铭。&lt;/p&gt;&lt;p&gt;&lt;a rel="attachment wp-att-3437" style="border: 0px; vertical-align: baseline; color: rgb(116, 51, 153); background: transparent;"&gt;&lt;img src="https://images.weserv.nl/?url=mmbiz.qpic.cn/mmbiz_png/Q3H1TCddfvPTzpWjtEFf3761157l7hWB1t4lW22qddlh14Mcmwlmb6IvGTt3WzoTRKxI5FUc1paiatHJEziakzng/0?wx_fmt=png"/&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;欢迎关注 AlgorithmDog。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img src="https://images.weserv.nl/?url=mmbiz.qpic.cn/mmbiz/Q3H1TCddfvPE2JpYR7tQ2eqqCLpF5ncuTx6MNCib7Qd3FF67BsxicqGoLo1Y44rRGAah5gUfUrV6QTjIVaanBsDA/0?wx_fmt=png"/&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;</description>
      <pubDate>Mon, 17 Oct 2016 00:38:48 +0800</pubDate>
    </item>
  </channel>
</rss>
